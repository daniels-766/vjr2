<!doctype html>
<html class="no-js" lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Manage Group</title>
        <meta name="description" content="">
        <meta name="keywords" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <link rel="icon" href="../static/assets/img/vjr3.png" type="image/x-icon" />

        <link href="https://fonts.googleapis.com/css?family=Nunito+Sans:300,400,600,700,800" rel="stylesheet">
        
        <link rel="stylesheet" href="../static/assets/node_modules/bootstrap/dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="../static/assets/node_modules/@fortawesome/fontawesome-free/css/all.min.css">
        <link rel="stylesheet" href="../static/assets/node_modules/ionicons/dist/css/ionicons.min.css">
        <link rel="stylesheet" href="../static/assets/node_modules/icon-kit/dist/css/iconkit.min.css">
        <link rel="stylesheet" href="../static/assets/node_modules/perfect-scrollbar/css/perfect-scrollbar.css">
        <link rel="stylesheet" href="../static/assets/node_modules/weather-icons/css/weather-icons.min.css">
        <link rel="stylesheet" href="../static/assets/node_modules/owl.carousel/dist/assets/owl.carousel.css">
        <link rel="stylesheet" href="../static/assets/node_modules/owl.carousel/dist/assets/owl.theme.default.css">
        <link rel="stylesheet" href="../static/assets/node_modules/chartist/dist/chartist.css">
        <link rel="stylesheet" href="../static/assets/dist/css/theme.min.css">
        <script src="../static/assets/js/vendor/modernizr-2.8.3.min.js"></script>
        <style>
            .custom-toast-container {
                position: fixed;
                top: 50px;
                right: 20px;
                z-index: 2147483647; /* maksimal untuk browser */
                display: flex;
                flex-direction: column;
                gap: 10px;
                pointer-events: none; /* biar klik elemen di bawahnya tetap bisa */
            }

            .custom-toast {
                display: flex;
                align-items: center;
                padding: 12px 16px;
                border-radius: 8px;
                color: #fff;
                font-size: 14px;
                min-width: 250px;
                box-shadow: 0px 4px 12px rgba(0,0,0,0.15);
                animation: fadeIn 0.4s ease, fadeOut 0.4s ease 2.6s;
                pointer-events: auto; /* biar tombol close bisa diklik */
            }

            .custom-toast-success { background-color: #28a745; }
            .custom-toast-error { background-color: #dc3545; }
            .custom-toast-notice { background-color: #17a2b8; }

            .toast-icon {
                margin-right: 10px;
                font-size: 18px;
            }

            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(-10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            @keyframes fadeOut {
                from { opacity: 1; transform: translateY(0); }
                to { opacity: 0; transform: translateY(-10px); }
            }

        </style>
        <style>
    /* Latar belakang modal transparan lembut */
    .modal-content {
        border-radius: 12px;
        border: none;
        background: #fdfdfd;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }

    /* Header */
    .modal-header {
        background: #f7f7f7;
        border-bottom: 1px solid #e5e5e5;
        border-radius: 12px 12px 0 0;
    }

    .modal-title {
        font-weight: 600;
        font-size: 1.2rem;
        color: #444;
    }

    /* Input & select */
    .form-control, .form-select {
        border-radius: 8px;
        border: 1px solid #ccc;
        transition: all 0.2s ease-in-out;
        background-color: #fff;
    }

    .form-control:focus, .form-select:focus {
        border-color: #a3b18a; /* hijau lembut */
        box-shadow: 0 0 0 0.15rem rgba(163, 177, 138, 0.25);
    }

    /* Label */
    .form-label {
        font-weight: 500;
        color: #555;
    }

    /* Footer */
    .modal-footer {
        border-top: 1px solid #e5e5e5;
    }

    /* Tombol */
    .btn-secondary {
        background-color: #d8e2dc;
        color: #333;
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
    }

    .btn-secondary:hover {
        background-color: #c7d6d0;
    }

    .btn-success {
        background-color: #a3b18a;
        border: none;
        border-radius: 8px;
        padding: 8px 16px;
    }

    .btn-success:hover {
        background-color: #8f9e75;
    }
</style>

    </head>

    <body>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="custom-toast-container position-fixed top-0 end-0 p-3" style="z-index: 500;">
                    {% for category, message in messages %}
                        <div class="custom-toast custom-toast-{{ 'danger' if category == 'error' else category }}">
                            <div class="toast-icon">
                                {% if category == 'success' %}
                                    ✅
                                {% elif category == 'error' %}
                                    ❌
                                {% else %}
                                    ℹ️
                                {% endif %}
                            </div>
                            <div class="toast-message">
                                <strong>
                                    {% if category == 'success' %}
                                        Success!
                                    {% elif category == 'error' %}
                                        Error!
                                    {% else %}
                                        Notice!
                                    {% endif %}
                                </strong>
                                <span>{{ message }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <div class="wrapper">
            <header class="header-top" header-theme="light">
                <div class="container-fluid">
                    <div class="d-flex justify-content-between">
                        <div class="top-menu d-flex align-items-center">
                            <button type="button" id="navbar-fullscreen" class="nav-link"><i class="ik ik-maximize"></i></button>
                        </div>
                        <div class="top-menu d-flex align-items-center">
                            <button type="button" class="nav-link ml-10 right-sidebar-toggle">
                                <i class="ik ik-message-square"></i>
                                <span class="badge bg-success">{{ online_users_count }}</span>
                            </button>
                            <div class="dropdown">
                                <a class="dropdown-toggle" href="#" id="userDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img class="avatar" src="../static/assets/img/vjr3.png" alt=""></a>
                                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                                    <a class="dropdown-item" href="{{ url_for('logout') }}"><i class="ik ik-power dropdown-icon"></i> Logout</a>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </header>

            <div class="page-wrap">
                <div class="app-sidebar colored">
                    <div class="sidebar-header">
                        <a class="header-brand" href="{{ url_for('dashboard') }}">
                            <div class="logo-img">
                            <img src="../static/assets/img/vjr2.png" 
                                class="header-brand-img" 
                                alt="lavalite" 
                                width="200" 
                                height="30">
                        </div>
                        </a>
                    </div>
                    
                    <div class="sidebar-content">
                        <div class="nav-container">
                            <nav id="main-menu-navigation" class="navigation-main">
                                <div class="nav-lavel">Navigation</div>
                                <div class="nav-item">
                                    <a href="{{ url_for('dashboard') }}"><i class="ik ik-bar-chart-2"></i><span>Dashboard</span></a>
                                </div>
                                <div class="nav-item">
                                    <a href="{{ url_for('manage_users') }}"><i class="ik ik-user"></i><span>Account Management</span></a>
                                </div>
                                <div class="nav-item active">
                                    <a href="{{ url_for('manage_group') }}"><i class="ik ik-users"></i><span>Group Management</span></a>
                                </div>
                                <div class="nav-lavel">Information</div>
                                <div class="nav-item">
                                    <a href="{{ url_for('upload_data') }}"><i class="ik ik-file-text"></i><span>Data Management</span></a>
                                </div>
                                <div class="nav-item">
                                    <a href="{{ url_for('my_case') }}"><i class="ik ik-edit"></i><span>Case Management</span></a>
                                </div>
                                <div class="nav-item">
                                    <a href="{{ url_for('login_logs') }}"><i class="ik ik-clock"></i><span>Log History</span></a>
                                </div>
                            </nav>
                        </div>
                    </div>
                </div>
                <div class="main-content">
                    <div class="container-fluid">
                        <div class="page-header">
                            <div class="row align-items-end">
                                <div class="col-lg-8">
                                    <div class="page-header-title">
                                        <i class="ik ik-users bg-blue"></i>
                                        <div class="d-inline">
                                            <h5>Group Management</h5>
                                            <span>List detail group for dashboard</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <nav class="breadcrumb-container" aria-label="breadcrumb">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item">
                                                <a href="{{ url_for('dashboard') }}"><i class="ik ik-home"></i></a>
                                            </li>
                                            <li class="breadcrumb-item">
                                                <a href="{{ url_for('dashboard') }}">Dashboard</a>
                                            </li>
                                            <li class="breadcrumb-item active" aria-current="page">Group Management</li>
                                        </ol>
                                    </nav>
                                </div>
                            </div>
                        </div>
                        <div class="modal fade" id="kt_modal_add_account" tabindex="-1" aria-labelledby="kt_modal_add_account_label" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="kt_modal_add_account_label">Add Account</h5>
                                    </div>
                                    <form action="{{ url_for('add_account') }}" method="POST">
                                        <div class="modal-body">
                                            <div class="mb-3">
                                                <label for="account-id" class="form-label">ID System</label>
                                                <input type="text" class="form-control" id="account-id" name="id" >
                                            </div>
                                            <div class="mb-3">
                                                <label for="account-username" class="form-label">Nama Akun</label>
                                                <input type="text" class="form-control" id="account-username" name="username">
                                            </div>
                                            <div class="mb-3">
                                                <label for="account-password" class="form-label">Password</label>
                                                <input type="password" class="form-control" id="account-password" name="password">
                                            </div>
                                            <div class="mb-3">
                                                <label for="account-number" class="form-label">No HP</label>
                                                <input type="number" class="form-control" id="account-number" name="number">
                                            </div>
                                            <div class="mb-3">
                                                <label for="account-email" class="form-label">Email</label>
                                                <input type="email" class="form-control" id="account-email" name="email">
                                            </div>
                                            <div class="mb-3">
                                                <label for="account-group" class="form-label">Group</label>
                                                <select class="form-select" id="account-group" name="group">
                                                    <option value="">-- Select Group --</option>
                                                    {% for group in groups %}
                                                    <option value="{{ group.id }}">{{ group.company }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label d-block">Role</label>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="role" id="role-user" value="user" required>
                                                    <label class="form-check-label" for="role-user">Collection Staff</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="role" id="role-admin" value="admin" required>
                                                    <label class="form-check-label" for="role-admin">Administrator</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-success">Add Account</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="modal fade" id="editGroupModal" tabindex="-1" aria-labelledby="editGroupModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                            <form method="POST" action="{{ url_for('update_group_status') }}">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editGroupModalLabel">Edit Group Status</h5>
                                </div>
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label class="form-label fw-bold"> Group Name : 
                                            <div id="modal-group-name" class="form-control-plaintext text-dark"></div></label>
                                    </div>                     
                                    <input type="hidden" name="group_id" id="modal-group-id">
                                    <div class="mb-3">
                                    <label for="modal-group-status" class="form-label">Status</label>
                                    <select class="form-select" name="status" id="modal-group-status" required>
                                        <option value="active">Active</option>
                                        <option value="nonactive">Nonactive</option>
                                    </select>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </div>
                                </div>
                            </form>
                            </div>
                        </div> 
                        <div class="modal fade" id="editUserModal" tabindex="-1" aria-labelledby="editUserModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                            <form method="POST" action="{{ url_for('update_user') }}">
                                <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editUserModalLabel">Edit User</h5>
                                </div>
                                <div class="modal-body">
                                    <input type="hidden" name="user_id" id="modal-user-id">
                        
                                    <div class="mb-3">
                                    <label class="form-label fw-bold">Username</label>
                                    <div id="modal-user-name" class="form-control-plaintext text-dark"></div>
                                    </div>
                        
                                    <div class="mb-3">
                                    <label for="modal-user-status" class="form-label">Status</label>
                                    <select class="form-select" name="status" id="modal-user-status" required>
                                        <option value="active">Active</option>
                                        <option value="nonactive">Nonactive</option>
                                    </select>
                                    </div>
                        
                                    <div class="mb-3">
                                    <label for="modal-user-password" class="form-label">New Password</label>
                                    <input type="password" name="password" class="form-control" id="modal-user-password" placeholder="Leave blank if unchanged">
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Save changes</button>
                                </div>
                                </div>
                            </form>
                            </div>
                        </div>
                        <div class="modal fade" id="kt_modal_del_account" tabindex="-1" aria-labelledby="kt_modal_del_account_label" aria-hidden="true">
                            <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                <h5 class="modal-title" id="kt_modal_del_account_label">Delete Account</h5>
                                </div>
                                <form action="{{ url_for('delete_account') }}" method="POST">
                                <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="account-id" class="form-label">Account Name</label>
                                        <select class="form-select" id="account-username" name="user_id" required>
                                            <option value="">-- Select Akun --</option>
                                            {% for user in users %}
                                                <option value="{{ user.id }}">{{ user.id_system }}</option>
                                            {% endfor %}
                                        </select>                          
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="delete_type" id="del-temp" value="temp" required>
                                        <label class="form-check-label" for="del-temp">Temporary Disconnection</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                        <input class="form-check-input" type="radio" name="delete_type" id="del-perm" value="perm" required>
                                        <label class="form-check-label" for="del-perm">Permanent/Delete</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" class="btn btn-danger">Delete Account</button>
                                </div>
                                </form>
                            </div>
                            </div>
                        </div>
                        <div class="modal fade" id="kt_modal_add_group" tabindex="-1" aria-labelledby="kt_modal_add_group_label" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title">Add Group</h5>
                                    </div>
                                    <form action="{{ url_for('add_group') }}" method="POST">
                                        <div class="modal-body">
                                            
                                            <div class="mb-3">
                                                <label for="company" class="form-label">Company</label>
                                                <select class="form-select" id="company" name="company" required>
                                                    <option value="">-- Select Company --</option>
                                                    <option value="Uatas">Uatas</option>
                                                    <option value="Akulaku">Akulaku</option>
                                                    <option value="Beaute">Beaute</option>
                                                    <option value="Debito">Debito</option>
                                                    <option value="Finplus">Finplus</option>
                                                    <option value="Julo">Julo</option>
                                                    <option value="Kredivo">Kredivo</option>
                                                    <option value="PinjamYuk">PinjamYuk</option>
                                                    <option value="TIN">TIN</option>
                                                    <option value="TrustIQ">TrustIQ</option>
                                                    <option value="Twinkle">Twinkle</option>
                                                    <option value="UangMe">UangMe</option>
                                                    <option value="BankVima">BankVima</option>
                                                    <option value="Oppo">Oppo</option>
                                                    <option value="DanaRupiah">DanaRupiah</option>
                                                </select>
                                            </div>

                                            <div class="mb-3 text-center">
                                                <img id="logoPreview" src="" alt="Logo Preview" style="max-width: 100px; display: none;">
                                            </div>

                                            <div class="mb-3">
                                                <label for="overdue" class="form-label">Overdue</label>
                                                <select class="form-select" id="overdue" name="overdue" required>
                                                    <option value="">-- Select Overdue --</option>
                                                    <option value="90-">Below 90</option>
                                                    <option value="90+">90+</option>
                                                </select>
                                            </div>

                                        </div>                    
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary">Add Group</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="modal fade" id="kt_modal_del_group" tabindex="-1" aria-labelledby="kt_modal_del_group_label" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="kt_modal_group_account_label">Delete Group</h5>
                                    </div>
                                    <form action="{{ url_for('delete_group') }}" method="POST">
                                        <div class="modal-body">
                                            <div class="mb-3">
                                                <label for="account-group" class="form-label">Group</label>
                                                <select class="form-select" id="account-group" name="group" required>
                                                    <option value="">-- Select Group --</option>
                                                    {% for group in groups %}
                                                    <option value="{{ group.id }}">{{ group.company }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="delete" id="del-temp" value="temp" required>
                                                    <label class="form-check-label" for="del-temp">Temporary Disconnection</label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input class="form-check-input" type="radio" name="delete" id="del-perm" value="perm" required>
                                                    <label class="form-check-label" for="del-perm">Permanent/Delete</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-danger">Delete Group</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="card table-card">
                                    <div class="card-header">
                                        <h3>List Group</h3>
                                        <div class="card-header-right">
                                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#kt_modal_add_group">
                                                <i class="ik ik-plus"></i>Add Group
                                            </button>
                                            <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#kt_modal_del_group">
                                                <i class="ik ik-trash-2"></i>Delete Group
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-block">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead>
                                                    <tr>
                                                        <th>Company</th>
                                                        <th class="text-center">Overdue</th>
                                                        <th class="text-center">Staff</th>
                                                        <th class="text-center">Status</th>
                                                        <th class="text-center">Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for group in groups %}
                                                    <tr>
                                                        <td>
                                                            <div class="d-inline-block align-middle">
                                                                <img src="{{ group.logo or '/static/assets/img/default.png' }}" 
                                                                    alt="{{ group.company }} logo" 
                                                                    class="rounded-circle img-40 align-top mr-15">
                                                                <div class="d-inline-block">
                                                                    <h6>{{ group.company }}</h6>
                                                                    <p class="text-muted mb-0">
                                                                        {{ group.users|length }} user
                                                                    </p>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center">
                                                            {% if group.overdue == '90-' %}
                                                                Below 90
                                                            {% else %}
                                                                {{ group.overdue }}
                                                            {% endif %}
                                                        </td>                                                        
                                                        <td class="text-center">
                                                            {% if group.users %}
                                                                <div class="d-flex flex-wrap justify-content-center gap-1">
                                                                    {% set max_display = 3 %}
                                                                    {% for user in group.users[:max_display] %}
                                                                        <span class="badge bg-light text-dark border">{{ user.username }}</span>
                                                                    {% endfor %}

                                                                    {% if group.users|length > max_display %}
                                                                        <span class="badge" style="cursor:pointer"
                                                                            data-bs-toggle="modal"
                                                                            data-bs-target="#userListModal{{ group.id }}">
                                                                            +{{ group.users|length - max_display }} more
                                                                        </span>
                                                                    {% endif %}
                                                                </div>

                                                                <div class="modal fade" id="userListModal{{ group.id }}" tabindex="-1" aria-hidden="true">
                                                                    <div class="modal-dialog modal-dialog-scrollable">
                                                                        <div class="modal-content">
                                                                            <div class="modal-header">
                                                                                <h5 class="modal-title">Users in {{ group.company }}</h5>
                                                                            </div>
                                                                            <div class="modal-body">
                                                                                <div class="d-flex flex-wrap gap-1">
                                                                                    {% for user in group.users %}
                                                                                        <span class="badge bg-light text-dark border">{{ user.username }}</span>
                                                                                    {% endfor %}
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </div>

                                                            {% else %}
                                                                <span class="text-muted fst-italic">No staff</span>
                                                            {% endif %}
                                                        </td>                                              
                                                        <td class="text-center">
                                                            {% if group.status == 'active' %}
                                                                <span class="badge badge-success">Active</span>
                                                            {% else %}
                                                                <span class="badge badge-danger">Inactive</span>
                                                            {% endif %}
                                                        </td>
                                                        <td class="text-center">
                                                            <a data-bs-toggle="modal" 
                                                                data-bs-target="#editGroupModal" 
                                                                data-group-id="{{ group.id }}"
                                                                data-group-name="{{ group.company }}"
                                                                data-group-status="{{ group.status }}">
                                                                <i class="ik ik-edit f-16 mr-15 text-green" style="cursor: pointer;"></i>
                                                            </a>
                                                        </td>                                                    
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-12 col-md-12">
                                <div class="card table-card">
                                    <div class="card-header">
                                        <h3>Group’s  performance</h3>
                                    </div>
                                    <div class="card-block">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0 without-header">
                                                <thead>
                                                    <tr>
                                                        <th>Company</th>
                                                        <th class="text-center">Total Account</th>
                                                        <th class="text-center">Total Data</th>
                                                        <th class="text-right">Percentage Remarks</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for gs in group_stats %}
                                                    <tr>
                                                        <td>
                                                            <div class="d-inline-block align-middle">
                                                                <img src="{{ gs.logo or '/static/assets/img/default.png' }}" 
                                                                    alt="{{ gs.company }} logo" 
                                                                    class="rounded-circle img-40 align-top mr-15">
                                                                <div class="d-inline-block">
                                                                    <h6 class="mb-0">{{ gs.company }}</h6>
                                                                    <p class="text-muted mb-0">Account : {{ gs.jumlah_akun }}</p>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td class="text-center">
                                                            <h6 class="fw-700">{{ gs.jumlah_akun }} Account</h6>
                                                        </td>
                                                        <td class="text-center">
                                                            <h6 class="fw-700">{{ gs.total_data }} Data</h6>
                                                        </td>
                                                        <td class="text-right">
                                                            <h6 class="fw-700">
                                                                {{ "%.2f"|format(gs.persen) }}%
                                                                {% if gs.persen < 50 %}
                                                                    <i class="fas fa-level-down-alt text-red ml-10"></i>
                                                                {% elif gs.persen >= 51 %}
                                                                    <i class="fas fa-level-up-alt text-green ml-10"></i>
                                                                {% endif %}
                                                            </h6>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <aside class="right-sidebar" style="max-height: 600px; overflow-y: auto;">
                    <div class="sidebar-chat" data-plugin="chat-sidebar">
                        <div class="sidebar-chat-info">
                            <h6>List Account Active</h6>
                            <form class="mr-t-10">
                                <div class="form-group">
                                    <input type="text" class="form-control" placeholder="Search for account ..."> 
                                    <i class="ik ik-search"></i>
                                </div>
                            </form>
                        </div>
                        <div class="chat-list">
                            <div class="list-group row">
                                {% for user in all_users %}
                                <span class="list-group-item" data-chat-user="{{ user.username }}">
                                    <figure class="{{ 'user--online' if user.is_online() else 'user--busy' }}">
                                        <img src="{{ user.group_rel.logo or '/static/assets/img/default.png' }}"
                                            alt="{{ user.group_rel.company }} logo"
                                            class="rounded-circle img-40 align-top mr-15">
                                    </figure>
                                    <span>
                                        <span class="name">{{ user.username }}</span>
                                        <span class="username">{{ user.last_seen_ago() }}</span>
                                    </span>
                                </span>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </aside>

                <div class="chat-panel" hidden>
                    <div class="card">
                        <div class="card-header d-flex justify-content-between">
                            <a href="javascript:void(0);"><i class="ik ik-message-square text-success"></i></a>  
                            <span class="user-name">John Doe</span> 
                            <button type="button" class="close" aria-label="Close"><span aria-hidden="true">×</span></button>
                        </div>
                        <div class="card-body">
                            <div class="widget-chat-activity flex-1">
                                <div class="messages">
                                    <div class="message media reply">
                                        <figure class="user--online">
                                            <a href="#">
                                                <img src="../static/assets/img/users/3.jpg" class="rounded-circle" alt="">
                                            </a>
                                        </figure>
                                        <div class="message-body media-body">
                                            <p>Epic Cheeseburgers come in all kind of styles.</p>
                                        </div>
                                    </div>
                                    <div class="message media">
                                        <figure class="user--online">
                                            <a href="#">
                                                <img src="../static/assets/img/users/1.jpg" class="rounded-circle" alt="">
                                            </a>
                                        </figure>
                                        <div class="message-body media-body">
                                            <p>Cheeseburgers make your knees weak.</p>
                                        </div>
                                    </div>
                                    <div class="message media reply">
                                        <figure class="user--offline">
                                            <a href="#">
                                                <img src="../static/assets/img/users/5.jpg" class="rounded-circle" alt="">
                                            </a>
                                        </figure>
                                        <div class="message-body media-body">
                                            <p>Cheeseburgers will never let you down.</p>
                                            <p>They'll also never run around or desert you.</p>
                                        </div>
                                    </div>
                                    <div class="message media">
                                        <figure class="user--online">
                                            <a href="#">
                                                <img src="../static/assets/img/users/1.jpg" class="rounded-circle" alt="">
                                            </a>
                                        </figure>
                                        <div class="message-body media-body">
                                            <p>A great cheeseburger is a gastronomical event.</p>
                                        </div>
                                    </div>
                                    <div class="message media reply">
                                        <figure class="user--busy">
                                            <a href="#">
                                                <img src="../static/assets/img/users/5.jpg" class="rounded-circle" alt="">
                                            </a>
                                        </figure>
                                        <div class="message-body media-body">
                                            <p>There's a cheesy incarnation waiting for you no matter what you palete preferences are.</p>
                                        </div>
                                    </div>
                                    <div class="message media">
                                        <figure class="user--online">
                                            <a href="#">
                                                <img src="../static/assets/img/users/1.jpg" class="rounded-circle" alt="">
                                            </a>
                                        </figure>
                                        <div class="message-body media-body">
                                            <p>If you are a vegan, we are sorry for you loss.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <form action="javascript:void(0)" class="card-footer" method="post">
                            <div class="d-flex justify-content-end">
                                <textarea class="border-0 flex-1" rows="1" placeholder="Type your message here"></textarea>
                                <button class="btn btn-icon" type="submit"><i class="ik ik-arrow-right text-success"></i></button>
                            </div>
                        </form>
                    </div>
                </div>
                <footer class="footer">
                    <div class="w-100 clearfix">
                        <span class="text-center text-sm-left d-md-inline-block">Copyright © 2025 VJR. All Rights Reserved.</span>
                    </div>
                </footer>
            </div>
        </div>
        
        
        

        <div class="modal fade apps-modal" id="appsModal" tabindex="-1" role="dialog" aria-labelledby="appsModalLabel" aria-hidden="true" data-backdrop="false">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><i class="ik ik-x-circle"></i></button>
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="quick-search">
                        <div class="container">
                            <div class="row">
                                <div class="col-md-4 ml-auto mr-auto">
                                    <div class="input-wrap">
                                        <input type="text" id="quick-search" class="form-control" placeholder="Search..." />
                                        <i class="ik ik-search"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-body d-flex align-items-center">
                        <div class="container">
                            <div class="apps-wrap">
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-bar-chart-2"></i><span>Dashboard</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-mail"></i><span>Message</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-users"></i><span>Accounts</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-shopping-cart"></i><span>Sales</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-briefcase"></i><span>Purchase</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-server"></i><span>Menus</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-clipboard"></i><span>Pages</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-message-square"></i><span>Chats</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-map-pin"></i><span>Contacts</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-box"></i><span>Blocks</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-calendar"></i><span>Events</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-bell"></i><span>Notifications</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-pie-chart"></i><span>Reports</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-layers"></i><span>Tasks</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-edit"></i><span>Blogs</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-settings"></i><span>Settings</span></a>
                                </div>
                                <div class="app-item">
                                    <a href="#"><i class="ik ik-more-horizontal"></i><span>More</span></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        <script>window.jQuery || document.write('<script src="../src/js/vendor/jquery-3.3.1.min.js"><\/script>')</script>
        <script src="../static/assets/node_modules/popper.js/dist/umd/popper.min.js"></script>
        <script src="../static/assets/node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="../static/assets/node_modules/perfect-scrollbar/dist/perfect-scrollbar.min.js"></script>
        <script src="../static/assets/node_modules/screenfull/dist/screenfull.js"></script>
        <script src="../static/assets/node_modules/owl.carousel/dist/owl.carousel.min.js"></script>
        <script src="../static/assets/node_modules/chartist/dist/chartist.min.js"></script>
        <script src="../static/assets/node_modules/flot-charts/jquery.flot.js"></script>
        <script src="../static/assets/node_modules/flot-charts/jquery.flot.categories.js"></script>
        <script src="../static/assets/node_modules/flot.curvedlines/curvedLines.js"></script>
        <script src="../static/assets/node_modules/jquery.flot.tooltip/js/jquery.flot.tooltip.js"></script>
        <script src="../static/assets/dist/js/theme.min.js"></script>
        <script src="../static/assets/js/widget-data.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
        <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='https://www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X','auto');ga('send','pageview');
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const roleAdminRadio = document.getElementById('role-admin');
                const roleUserRadio = document.getElementById('role-user');
                
                const accountIdField = document.getElementById('account-id');       // ID System
                const accountUsernameField = document.getElementById('account-username');  // Nama Akun
                const accountPasswordField = document.getElementById('account-password');  // Password
                const accountPhoneField = document.getElementById('account-number');  // No HP
                const accountEmailField = document.getElementById('account-email');    // Email
                const accountGroupField = document.getElementById('account-group');   // Group
                
                const submitButton = document.querySelector('button[type="submit"]');  // Tombol Add Account
                
                function validateForm() {
                    let isFormValid = true;
        
                    if (roleAdminRadio.checked) {
                        if (!accountUsernameField.value || !accountPasswordField.value) {
                            isFormValid = false;
                        }
                    } else if (roleUserRadio.checked) {  
                        if (!accountUsernameField.value || 
                            !accountPasswordField.value || 
                            !accountPhoneField.value || 
                            !accountEmailField.value || 
                            !accountGroupField.value) {
                            isFormValid = false;
                        }
                    }
                    
                    submitButton.disabled = !isFormValid;
                    submitButton.classList.toggle('disabled', !isFormValid); 
                }
        
                function toggleFields() {
                    if (roleAdminRadio.checked) {
                        accountIdField.parentElement.style.display = 'none';
                        accountPhoneField.parentElement.style.display = 'none';
                        accountEmailField.parentElement.style.display = 'none';
                        accountGroupField.parentElement.style.display = 'none';
        
                        accountPhoneField.removeAttribute('required');
                        accountEmailField.removeAttribute('required');
                        accountGroupField.removeAttribute('required');
                    } else {
                        accountIdField.parentElement.style.display = 'block';
                        accountPhoneField.parentElement.style.display = 'block';
                        accountEmailField.parentElement.style.display = 'block';
                        accountGroupField.parentElement.style.display = 'block';
        
                        accountPhoneField.setAttribute('required', 'required');
                        accountEmailField.setAttribute('required', 'required');
                        accountGroupField.setAttribute('required', 'required');
                    }
        
                    validateForm();
                }
        
                roleAdminRadio.addEventListener('change', toggleFields);
                roleUserRadio.addEventListener('change', toggleFields);
        
                accountUsernameField.addEventListener('input', validateForm);
                accountPasswordField.addEventListener('input', validateForm);
                accountPhoneField.addEventListener('input', validateForm);
                accountEmailField.addEventListener('input', validateForm);
                accountGroupField.addEventListener('change', validateForm);
        
                toggleFields();
            });
        </script>
        <script>
            setTimeout(function() {
                const alert = document.getElementById("flash-alert");
                if (alert) {
                    let bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
                    bsAlert.close();
                }
            }, 3000);
        </script>
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var editModal = document.getElementById('editGroupModal');
                editModal.addEventListener('show.bs.modal', function (event) {
                    var button = event.relatedTarget;
                    var groupId = button.getAttribute('data-group-id');
                    var groupName = button.getAttribute('data-group-name');
                    var groupStatus = button.getAttribute('data-group-status');
            
                    document.getElementById('modal-group-id').value = groupId;
                    document.getElementById('modal-group-status').value = groupStatus;
                    document.getElementById('modal-group-name').textContent = groupName;
                });
            });
            </script>
            <script>
                const companySelect = document.getElementById('company');
                const logoPreview = document.getElementById('logoPreview');

                const logos = {
                    "Uatas": "/static/assets/img/3rd/uatas.png",
                    "Akulaku": "/static/assets/img/3rd/akulaku.png",
                    "Beaute": "/static/assets/img/3rd/danarupiah.jpeg",
                    "Debito": "/static/assets/img/3rd/debito.jpeg",
                    "Finplus": "/static/assets/img/3rd/fp.png",
                    "Julo": "/static/assets/img/3rd/julo.png",
                    "Kredivo": "/static/assets/img/3rd/kredivo.jpg",
                    "PinjamYuk": "/static/assets/img/3rd/pinjamyuk.jpg",
                    "TIN": "/static/assets/img/3rd/tin.png",
                    "TrustIQ": "/static/assets/img/3rd/trustiq.png",
                    "Twinkle": "/static/assets/img/3rd/twinkle.png",
                    "UangMe": "/static/assets/img/3rd/uangme.png",
                    "BankVima": "/static/assets/img/3rd/vima.jpg",
                    "Oppo": "/static/assets/img/3rd/oppo.png",
                    "DanaRupiah": "/static/assets/img/3rd/danarupiah.jpeg"
                };

                companySelect.addEventListener('change', function () {
                    const selected = companySelect.value;
                    if (logos[selected]) {
                        logoPreview.src = logos[selected];
                        logoPreview.style.display = 'block';
                    } else {
                        logoPreview.style.display = 'none';
                    }
                });
            </script>
            <script>
                document.addEventListener("DOMContentLoaded", function(){
                    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
                    tooltipTriggerList.map(function (tooltipTriggerEl) {
                        return new bootstrap.Tooltip(tooltipTriggerEl)
                    });
                });
            </script>
            <script>
            document.addEventListener("DOMContentLoaded", function() {
                const searchInput = document.querySelector(".sidebar-chat-info input");
                const items = document.querySelectorAll(".list-group-item");

                searchInput.addEventListener("keyup", function() {
                    const query = this.value.toLowerCase();
                    items.forEach(item => {
                        const name = item.querySelector(".name").textContent.toLowerCase();
                        const username = item.querySelector(".username").textContent.toLowerCase();
                        if (name.includes(query) || username.includes(query)) {
                            item.style.display = "";
                        } else {
                            item.style.display = "none";
                        }
                    });
                });
            });
            </script>
    </body>
</html>
